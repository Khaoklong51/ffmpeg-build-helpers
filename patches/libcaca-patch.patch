diff --git a/caca/caca.c b/caca/caca.c
index 327a8f9..a9f461d 100644
--- a/caca/caca.c
+++ b/caca/caca.c
@@ -284,7 +284,7 @@ char const * caca_get_version(void)
  * XXX: The following functions are private.
  */
 
-extern void *_caca_alloc2d(size_t width, size_t height, size_t elem_size)
+void *_caca_alloc2d(size_t width, size_t height, size_t elem_size)
 {
     if (width == 0 || height == 0 || elem_size == 0 || SIZE_MAX / width / height < elem_size)
         return NULL;
diff --git a/caca/caca.h b/caca/caca.h
index 9f79be2..328e791 100644
--- a/caca/caca.h
+++ b/caca/caca.h
@@ -30,9 +30,9 @@
 #undef __extern
 #if defined _DOXYGEN_SKIP_ME
 #elif defined _WIN32 && defined __LIBCACA__ && defined DLL_EXPORT
-#   define __extern extern __declspec(dllexport)
+#   define __extern extern 
 #elif defined _WIN32 && !defined __LIBCACA__ && !defined CACA_STATIC
-#   define __extern extern __declspec(dllimport)
+#   define __extern extern 
 #elif defined CACA_ENABLE_VISIBILITY
 #   define __extern extern __attribute__((visibility("default")))
 #else
diff --git a/caca/caca0.h b/caca/caca0.h
index 97f155e..341c34d 100644
--- a/caca/caca0.h
+++ b/caca/caca0.h
@@ -23,9 +23,9 @@
 #undef __extern
 #if defined _DOXYGEN_SKIP_ME
 #elif defined _WIN32 && defined __LIBCACA__ && defined DLL_EXPORT
-#   define __extern extern __declspec(dllexport)
+#   define __extern extern 
 #elif defined _WIN32 && !defined __LIBCACA__
-#   define __extern extern __declspec(dllimport)
+#   define __extern extern 
 #elif defined CACA_ENABLE_VISIBILITY
 #   define __extern extern __attribute__((visibility("default")))
 #else
diff --git a/caca/caca_internals.h b/caca/caca_internals.h
index 7b74b9e..0bd7f6c 100644
--- a/caca/caca_internals.h
+++ b/caca/caca_internals.h
@@ -268,7 +268,7 @@ extern int _caca_pop_event(caca_display_t *, caca_privevent_t *);
 extern void _caca_set_term_title(char const *);
 
 /* Internal memory function */
-extern void *_caca_alloc2d(size_t width, size_t height, size_t elem_size);
+__extern void *_caca_alloc2d(size_t width, size_t height, size_t elem_size);
 
 /* Profiling functions */
 #if defined PROF
diff --git a/src/common-image.c b/src/common-image.c
index 7059bf4..d40eba1 100644
--- a/src/common-image.c
+++ b/src/common-image.c
@@ -22,6 +22,7 @@
 #endif
 
 #include "caca.h"
+#include "caca_internals.h"
 
 #include "common-image.h"
 
